#!/bin/bash
# Meant to be run DIRECTLY from a fresh archiso live cd. Try typing, for example:
# [root@archiso]$ dhcpcd eth0
# [root@archiso]$ . <(wget https://raw.github.com/twomen/proterozoic/master/bootstrap-this -qO -)

# Then you probably want to run this:
# root 123m~$ aif -p enzymes/polymerase -d
echo bootstrapping for the 2011.08.19 live cd...

arch=$(uname -m)
GITURL=https://raw.github.com/twomen/proterozoic/master

mv -f /etc/rc.conf{,.original}
mv -f /etc/pacman.conf{,.original}
wget $GITURL/usr/share/ppz/default-rc.conf		-qO	/etc/rc.conf
wget $GITURL/etc/pacman.d/mirrorlist.otown		-qO	/etc/pacman.d/mirrorlist.otown.tmp
wget $GITURL/usr/share/ppz/default-pacman.conf	-qO	/etc/pacman.conf
sed -i \
	 -e 's/^IgnorePkg = /\0aif/ig' \
	 -e s/otown/otown.tmp/ig									/etc/pacman.conf
sed -i \
	 -e s/%SET_HOSTNAME%/archiso/ig \
	 -e 's/^SSH_USERS.*$/SSH_USERS=(root)/ig'				/etc/rc.conf

[ $arch = i686 ] && sed -i 's/\[multilib\]/#\0/ig' /etc/pacman.conf

pacman --noprogressbar --noconfirm --needed -Sqy pacman
pacman --noprogressbar --noconfirm --needed -Squ smartmontools base-devel proterozoic #aif

sed -i s/otown.tmp/otown/ig									/etc/pacman.conf
rm -f /etc/pacman.d/mirrorlist.otown.tmp

add_hook() { :; }
. /etc/rc.conf
. /etc/rc.d/functions.d/ppz
custom_iptables_rules
