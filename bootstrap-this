#!/bin/bash

# Meant to be run DIRECTLY from a fresh archiso live cd. Try typing, for example:
# [root@archiso]$ dhcpcd eth0
# [root@archiso]$ . <(wget https://raw.github.com/twomen/proterozoic/master/bootstrap-this -qO -)

# Then you probably want to run this:
# root 123m~$ aif -p enzymes/polymerase -d

echo bootstrapping for the 2011.06.10 live cd...

mkdir -p \
	 /media/arch-cold-rw \
	 /media/arch-cold-ro \
	 /media/rodinia \
	 /media/green
ln -s /media/rodinia/pub /snowball
#cryptsetup luksOpen /dev/disk/by-uuid/0105eeab-2fc6-4dc7-8b89-4a70605e1483 green
#mount /dev/disk/by-uuid/913e0e86-9eb2-4dd5-9513-6b34f26f37cc /media/rodinia
#mount /dev/disk/by-uuid/45d0d831-d045-410c-b2ec-d525ef69e36c /media/arch-cold-rw
#mount /dev/disk/by-uuid/5b25f749-ab8d-4749-a8b0-3b7d3408af19 /media/arch-cold-ro
#mount /dev/mapper/green /media/green

arch=$(uname -m)

wget http://schlunix.org/archlinux/extra/os/$arch/git-1.7.5.2-1-$arch.pkg.tar.xz    -qO /tmp/git-1.7.5.2-1-$arch.pkg.tar.xz
wget http://schlunix.org/archlinux/extra/os/$arch/python2-2.7.2-1-$arch.pkg.tar.xz  -qO /tmp/python2-2.7.2-1-$arch.pkg.tar.xz
wget https://raw.github.com/twomen/proterozoic/master/etc/pacman.d/mirrorlist.otown -qO /etc/pacman.d/mirrorlist.otown.tmp
wget https://raw.github.com/twomen/proterozoic/master/etc/pacman.conf.bootstrap -qO - | sed s/otown/otown.tmp/ig > /tmp/pacman.conf.ppz

mv /etc/sudoers{,.archiso-default}

pacman --config /tmp/pacman.conf.ppz --noprogressbar --noconfirm -Syq
# necessary because of the aufs/kernel drama going on. Hopefully it can be temporary...
pacman --config /tmp/pacman.conf.ppz --noprogressbar --noconfirm -U /tmp/git-1.7.5.2-1-$arch.pkg.tar.xz /tmp/python2-2.7.2-1-$arch.pkg.tar.xz
pacman --config /tmp/pacman.conf.ppz --noprogressbar --noconfirm -Sq proterozoic

rm /tmp/pacman.conf.ppz /etc/pacman.d/mirrorlist.otown.tmp
