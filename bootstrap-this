#!/usr/bin/bash
# [root@archiso]$ dhcpcd eth0
# [root@archiso]$ . <(wget https://raw.github.com/yardenac/proterozoic/master/bootstrap-this -qLO-)
# root 123m~$ /usr/bin/integrity.ppz
# root 123m~$ aif -p enzymes/polymerase -d
echo bootstrapping for the 2013.09.01 live cd...

ionice -c 3 -p $$
renice -n 19 $$

GITURL=https://raw.github.com/yardenac/proterozoic/master

mv -f /etc/pacman.conf{,.original}
wget $GITURL/usr/share/ppz/default/ppz.conf		-qO	/etc/ppz.conf
wget $GITURL/etc/pacman.d/mirrorlist.otown		-qO	/etc/pacman.d/mirrorlist.otown.tmp
wget $GITURL/usr/share/ppz/default/pacman.conf	-qO	/etc/pacman.conf
sed -i \
	 -e 's/^IgnorePkg[ =]*/\0 linux /ig' \
	 -e s/otown/otown.tmp/ig									/etc/pacman.conf
sed -i \
	 -e s/^LUSER=.*$/LUSER=eu/ig
	 -e s/%SET_TYPE%/desktop/ig								/etc/ppz.conf

[ "$(uname -m)" = i686 ] && sed -i 's/\[multilib\]/#\0/ig' /etc/pacman.conf

pacman --noconfirm -Sy proterozoic
pacman --noconfirm -Scc

sed -i s/otown.tmp/otown/ig									/etc/pacman.conf
rm -f /etc/pacman.d/mirrorlist.otown.tmp

mkdir /etc/ssh/keys
echo 'ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBACr529+8mpJaMbfeXKAYFba9nhnv6nTlDd7VwnTSQda2aJXuwOu/aRD8GImPhu789x/KZFCALi9wTboRUYEprEKAwBQzl1vhqs7ZRniieF0b8MeOJNt3mEw+dXokuApne93VM+3QO20Vu26MQy7YN43pUqELI7zyUdSPMRVpmmCwWo6aA==' \
	 >| /etc/ssh/keys/eu
