#!/bin/bash

# Meant to be run DIRECTLY from a fresh archiso live cd. Try typing, for example:
# [root@archiso]$ dhcpcd eth0
# [root@archiso]$ . <(wget https://raw.github.com/twomen/proterozoic/master/bootstrap-this -qO -)

# Then you probably want to run this:
# root 123m~$ aif -p enzymes/polymerase -d

mkdir \
	 /media/arch-cold-rw \
	 /media/arch-cold-ro \
	 /media/rodinia \
	 /media/green
ln -s /media/rodinia/pub /snowball
#cryptsetup luksOpen /dev/disk/by-uuid/0105eeab-2fc6-4dc7-8b89-4a70605e1483 green
#mount /dev/disk/by-uuid/913e0e86-9eb2-4dd5-9513-6b34f26f37cc /media/rodinia
#mount /dev/disk/by-uuid/45d0d831-d045-410c-b2ec-d525ef69e36c /media/arch-cold-rw
#mount /dev/disk/by-uuid/5b25f749-ab8d-4749-a8b0-3b7d3408af19 /media/arch-cold-ro
#mount /dev/mapper/green /media/green

wget http://schlunix.org/archlinux/extra/os/x86_64/git-1.7.5.2-1-x86_64.pkg.tar.xz  -qO /tmp/git-1.7.5.2-1-x86_64.pkg.tar.xz
wget http://schlunix.org/archlinux/core/os/x86_64/perl-5.12.3-1-x86_64.pkg.tar.xz   -qO /tmp/perl-5.12.3-1-x86_64.pkg.tar.xz
wget https://raw.github.com/twomen/proterozoic/master/etc/pacman.d/mirrorlist.otown -qO /etc/pacman.d/mirrorlist.otown.tmp
wget https://raw.github.com/twomen/proterozoic/master/etc/pacman.conf.bootstrap -qO - | sed s/otown/otown.tmp/ig > /tmp/pacman.conf.ppz

mv /etc/sudoers{,.archiso-default}

pacman --config /tmp/pacman.conf.ppz --noconfirm -Sy
# necessary because of the aufs/kernel drama going on. Hopefully it can be temporary...
pacman --config /tmp/pacman.conf.ppz --noconfirm -U /tmp/git-1.7.5.2-1-x86_64.pkg.tar.xz /tmp/perl-5.12.3-1-x86_64.pkg.tar.xz
pacman --config /tmp/pacman.conf.ppz --noconfirm -Sy proterozoic

rm /tmp/pacman.conf.ppz /etc/pacman.d/mirrorlist.otown.tmp
