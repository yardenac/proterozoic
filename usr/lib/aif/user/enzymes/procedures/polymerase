#!/usr/bin/false

exit

mkdir -p /mnt/base/etc/pacman.d
sed -e 's/^IgnorePkg[ =]*/\0 linux-linode /ig' \
    -e s/https-only/https-only.random/ig \
    /usr/share/ppz/default/pacman.conf | \
    sudo tee /mnt/etc/pacman.conf
sudo cp /etc/pacman.d/mirrorlist.https-only.random /mnt/etc/pacman.d/

pacstrap /mnt base grub
sudo bash -c 'echo $hostname > /mnt/etc/hostname'
sudo cp /etc/ppz.conf /mnt/etc/ppz.conf
sudo ln -s /usr/share/zoneinfo/America/Los_Angeles /mnt/etc/localtime
sudo mv -i /etc/mkinitcpio.conf{,.orig}
sudo cp /etc/mkinitcpio.conf.ppz /mnt/etc/mkinitcpio.conf
genfstab -U -p /mnt | sudo tee -a /mnt/etc/fstab

# add modules to mkinitcpio.conf like: radeon nvidia intel_agp i915

arch-chroot /mnt
	pacman -Syu "${pkgs[@]}"
	pacman -Syu proterozoic
	mkinitcpio -p linux
	grub-install --target=i386-pc --recheck --debug /dev/sda
	grub-mkconfig -o /boot/grub/grub.cfg
#  networking

pkgs_always=(tor privoxy proterozoic)
pkgs_x=(xorg-{server,xinit,xrdb,xsetroot,xhost,xwininfo,xrandr} xdotool \
        xf86-input-{keyboard,mouse} xscreensaver xclip libxft xcursor-themes \
        numlockx fvwm perl-xml-parser fbpanel wmctrl mingetty hsetroot \
        urxvt-url-select urxvt-tabbedex transset-df xcompmgr acpi ttf-code2000
        xf86-video-ati xf86-video-intel nvidia mtpfs memtest86+ mprime mtester)
pkgs_web=(alsa-utils sext chromium)
pkgs_cd=(eject cdrkit dvd+rw-tools handbrake-cli libisoburn squashfs-tools archiso-git)
pkgs_wireless=(wireless_tools wpa_supplicant b43-firmware iw) #wpa_actiond ifplugd
pkgs_laptop=(dhcpcd)
pkgs_printer=(cups hplip a2ps)
pkgs_other=(parted dmidecode base-devel amd-ucode intel-ucode)
