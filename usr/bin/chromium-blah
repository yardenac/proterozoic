#!/usr/bin/bash

tor=true
proxy=--proxy-server=localhost:8118
resolv='--host-resolver-rules=MAP * 0.0.0.0'
configdir=/etc/skel.ppz/.config/chromium
urls=()
for arg; do
	 [[ "$arg" =~ ^[0-9]+$ ]] && {
		  proxy=--proxy-server=socks5://localhost:"$arg"
		  tor=false
		  continue
	 }
	 case "$arg" in
		  tor)     :;;
		  noproxy) proxy=''; resolv=''; tor=false;;
		  mine)    configdir="${HOME}/.config/chromium";;
		  *)       urls+=("$arg");;
	 esac
done

(( "${#urls[@]}" )) || {
	 if $tor; then
		  urls=('http://3g2upl4pq6kufc4m.onion/?kp=-1&kf=w&kk=-1&k1=-1&ko=s')
	 else
		  urls=('chrome://version')
	 fi
}

. /usr/share/ppz/bash.functions

uniqtok=$(uniq_token)

uniqdir="$HOME/.config/chromium.$uniqtok"

cp -r "$configdir" "$uniqdir"

ionice -c 2 -n 0 nice -n 10 \
	 chromium --incognito --load-extension=/usr/share/https-everywhere-chrome-git \
	 --ssl-version-min=tls1 \
	 --user-data-dir="$uniqdir" "$proxy" "$resolv" "${urls[@]}"

rm -rf "$uniqdir" "$HOME/.cache/chromium.$uniqtok"
