#!/bin/bash
# mplayer but a little easier

. /usr/share/ppz/bash.functions
. /usr/share/ppz/bash.functions.xorg

do_unto_others

args=(); x=1030; y=250; holdss=y
for arg; do
	 case "$arg" in
		  d) y=-1000;;
		  e) x=200;;
		  f) x=1290;;
		  m) holdss='';;
		  *) args+=("$arg")
	 esac
done

set_xtitle "[mm] $*"

[ "$holdss" ] && {
	 holdss &
	 trap "kill -SIGHUP $!" EXIT HUP QUIT INT TERM ABRT
}

{
	 c=10
	 while sleep 0.3; do
		  [ "$(ps --ppid $$ -o comm=)" == mm ] && break
		  let c-- || break
	 done
	 sudo -u ex FvwmCommand Refresh
} &>/dev/null &

ionice -c 2 -n 0 nice -n -5 mplayer -geometry $x:$y -fs -ao alsa \
	 -stop-xscreensaver -msglevel all=1:statusline=9 -nolirc \
	 -input nodefault-bindings:conf=/usr/share/ppz/mplayer.input.conf "${args[@]}"

echo

# leftover for pretty-printing statusline
# -msglevel all=5:statusline=9 2>&1 | nice -n -28 tr "\r" "\n" | \
# nice -n -28 awk -f ~/bin# /mawk -v qfilename="$MF" '
