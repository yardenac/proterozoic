#!/bin/bash
. /etc/bash.functions

[ -L ~/.emacs.d ] || {
	 mv .emacs.d .emacs.d.$(uniq_token)
	 ln -s /etc/.emacs.d ~/
}

am_root || exit

sed -i 's%^\(/bin/rm -rf /tmp.*\)$%\#\1%ig' /etc/rc.sysinit

for F in /{root,home/*}/.bash_history; do
	 [ -f "$F" ] || continue
	 lsattr "$F" >/dev/null 2>&1 && {
		  ATTRSET=$(lsattr "$F")
		  [ ${ATTRSET:5:1} != a ] && say_and_do chattr +a "$F"
	 }
done

enforce_perms 444 /etc/.emacs.d/init.el
enforce_perms 555 /etc/.emacs.d
